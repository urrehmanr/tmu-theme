!function(e){"use strict";var t={init:function(){this.bindEvents(),this.initProgressBars(),this.initTooltips()},bindEvents:function(){e(document).on("click","#bulk-tmdb-sync",this.handleBulkTMDBSync),e(document).on("click","#data-health-check",this.handleDataHealthCheck),e(document).on("click",".tmu-sync-all-link",this.handleAdminBarSync),e(document).on("tmu:progress:update",this.updateProgress),e(document).on("tmu:progress:complete",this.completeProgress),e(document).on("click",".notice-dismiss",this.dismissNotice)},initProgressBars:function(){e(".progress-fill").each(function(){var t=e(this),s=t.data("percentage")||0;t.css("width",s+"%")})},initTooltips:function(){e("[data-tooltip]").each(function(){var t=e(this),s=t.data("tooltip");t.attr("title",s)})},handleBulkTMDBSync:function(s){if(s.preventDefault(),confirm(tmuAdmin.strings.confirm_sync)){var n=e(this),i=e("#action-progress"),a=e(".progress-text"),o=e(".progress-fill");i.show(),n.prop("disabled",!0).addClass("loading"),a.text(tmuAdmin.strings.syncing),t.performBulkSync().then(function(e){o.css("width","100%"),a.text(tmuAdmin.strings.sync_complete),setTimeout(function(){i.hide(),n.prop("disabled",!1).removeClass("loading"),t.showNotice("success",e.message)},1e3)}).catch(function(e){a.text(tmuAdmin.strings.sync_error),n.prop("disabled",!1).removeClass("loading"),t.showNotice("error",e.message||tmuAdmin.strings.sync_error),setTimeout(function(){i.hide()},2e3)})}},handleDataHealthCheck:function(s){s.preventDefault();var n=e(this);n.prop("disabled",!0).addClass("loading"),setTimeout(function(){n.prop("disabled",!1).removeClass("loading"),t.showNotice("success","Data health check completed successfully!")},2e3)},handleAdminBarSync:function(s){if(s.preventDefault(),confirm(tmuAdmin.strings.confirm_sync)){var n=e(this);n.addClass("loading"),t.performBulkSync().then(function(e){n.removeClass("loading"),t.showNotice("success",e.message)}).catch(function(e){n.removeClass("loading"),t.showNotice("error",e.message)})}},performBulkSync:function(){return new Promise(function(t,s){e.ajax({url:tmuAdmin.ajaxurl,type:"POST",data:{action:"tmu_bulk_tmdb_sync",nonce:tmuAdmin.nonce,post_type:tmuAdmin.postType||"all"},success:function(e){e.success?t(e.data):s(e.data)},error:function(e,t,n){s({message:"AJAX request failed: "+n})}})})},updateProgress:function(t,s){var n=s.percentage||0,i=s.text||"";e(".progress-fill").css("width",n+"%"),e(".progress-text").text(i)},completeProgress:function(t,s){e(".progress-fill").css("width","100%"),e(".progress-text").text(s.text||"Complete!"),setTimeout(function(){e("#action-progress").fadeOut()},2e3)},showNotice:function(t,s){var n=e("<div>").addClass("notice notice-"+t+" is-dismissible").html("<p>"+s+"</p>").hide();e(".wrap").prepend(n),n.slideDown(),setTimeout(function(){n.slideUp(function(){e(this).remove()})},5e3)},dismissNotice:function(){e(this).closest(".notice").slideUp(function(){e(this).remove()})},formatNumber:function(e){return e.toString().replace(/\B(?=(\d{3})+(?!\d))/g,",")},timeAgo:function(e){var t=new Date-new Date(e),s=Math.floor(t/6e4),n=Math.floor(t/36e5),i=Math.floor(t/864e5);return i>0?i+" day"+(i>1?"s":"")+" ago":n>0?n+" hour"+(n>1?"s":"")+" ago":s>0?s+" minute"+(s>1?"s":"")+" ago":"Just now"}},s={init:function(){this.bindEvents()},bindEvents:function(){e(document).on("click","#tmdb-sync-btn",this.handleSync),e(document).on("click","#tmdb-search-btn",this.handleSearch),e(document).on("click","#tmdb-verify-btn",this.handleVerify),e(document).on("click","#tmdb-clear-btn",this.handleClear),e(document).on("click","#tmdb-refresh-btn",this.handleRefresh),e(document).on("click",".tmdb-search-result",this.selectResult),e(document).on("keypress","#tmdb_search",this.handleSearchKeypress)},handleSync:function(t){t.preventDefault(),confirm(tmuTMDB.strings.confirm_overwrite)&&(s.showLoading(tmuTMDB.strings.syncing),e.ajax({url:tmuTMDB.ajaxurl,type:"POST",data:{action:"tmu_tmdb_sync",nonce:tmuTMDB.nonce,post_id:tmuTMDB.postId,force:!0},success:function(e){s.hideLoading(),e.success?(s.showMessage("success",e.data.message),setTimeout(function(){location.reload()},1500)):s.showMessage("error",e.data.message)},error:function(){s.hideLoading(),s.showMessage("error",tmuTMDB.strings.sync_error)}}))},handleSearch:function(t){t.preventDefault();var n=e("#tmdb_search").val().trim();n?(s.showLoading(tmuTMDB.strings.searching),e.ajax({url:tmuTMDB.ajaxurl,type:"POST",data:{action:"tmu_tmdb_search",nonce:tmuTMDB.nonce,query:n,post_type:tmuTMDB.postType},success:function(e){s.hideLoading(),e.success?s.displaySearchResults(e.data.results):s.showMessage("error",e.data.message)},error:function(){s.hideLoading(),s.showMessage("error","Search failed. Please try again.")}})):s.showMessage("error","Please enter a search term.")},handleSearchKeypress:function(t){13===t.which&&(t.preventDefault(),e("#tmdb-search-btn").click())},handleVerify:function(t){t.preventDefault(),e("#tmdb_id_manual").val().trim()?s.showMessage("success","TMDB ID set. Save the post to apply changes."):s.showMessage("error","Please enter a TMDB ID.")},handleClear:function(t){t.preventDefault(),confirm("Clear all TMDB data? This cannot be undone.")&&(e("#tmdb_id, #tmdb_id_manual").val(""),s.showMessage("success","TMDB data cleared. Save the post to apply changes."))},handleRefresh:function(e){e.preventDefault(),location.reload()},selectResult:function(){e(".tmdb-search-result").removeClass("selected"),e(this).addClass("selected");var t=e(this).data("tmdb-id");e("#tmdb_id_manual").val(t)},displaySearchResults:function(t){var s=e("#tmdb-search-results");s.empty(),t&&0!==t.length?(t.forEach(function(t){var n=e("<div>").addClass("tmdb-search-result").attr("data-tmdb-id",t.id).html('<div class="result-title">'+(t.title||t.name)+'</div><div class="result-meta">'+(t.release_date||t.first_air_date||"No date")+" â€¢ ID: "+t.id+"</div>");s.append(n)}),s.show()):s.html("<p>"+tmuTMDB.strings.no_results+"</p>").show()},showLoading:function(t){e("#tmdb-loading-text").text(t||"Loading..."),e("#tmdb-loading").show()},hideLoading:function(){e("#tmdb-loading").hide()},showMessage:function(t,s){var n=e("#tmdb-messages"),i=e("<div>").addClass("notice notice-"+t).html("<p>"+s+"</p>");n.html(i),setTimeout(function(){i.fadeOut()},5e3)}};e(document).ready(function(){t.init(),e(".tmu-tmdb-metabox").length&&s.init()}),window.TMUAdmin=t,window.TMDBMetaBox=s}(jQuery);