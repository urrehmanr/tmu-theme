(()=>{function t(e){return t="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},t(e)}function e(t,e){var o=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter(function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable})),o.push.apply(o,n)}return o}function o(e,o,n){return(o=function(e){var o=function(e){if("object"!=t(e)||!e)return e;var o=e[Symbol.toPrimitive];if(void 0!==o){var n=o.call(e,"string");if("object"!=t(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==t(o)?o:o+""}(o))in e?Object.defineProperty(e,o,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[o]=n,e}!function(t){"use strict";var n={init:function(){this.bindEvents(),this.initProgressModal()},bindEvents:function(){var e=this;t("#test-api").on("click",this.testApiConnection.bind(this)),t("#bulk-sync").on("click",this.bulkSync.bind(this)),t("#sync-movies").on("click",function(){return e.bulkSync("movie")}),t("#sync-tv").on("click",function(){return e.bulkSync("tv")}),t("#sync-people").on("click",function(){return e.bulkSync("people")}),t("#clear-cache").on("click",this.clearCache.bind(this)),t("#test-webhook").on("click",this.testWebhook.bind(this)),t(".tmu-sync-single").on("click",this.syncSingle.bind(this)),t(".tmu-quick-view").on("click",this.quickView.bind(this)),t(".tmu-add-watchlist").on("click",this.addToWatchlist.bind(this)),t(".tmu-trailer-btn").on("click",this.showTrailer.bind(this)),t(document).on("click",".tmu-modal-close, .tmu-modal-overlay",this.closeModal.bind(this)),t(document).on("keyup",function(t){27===t.keyCode&&e.closeModal()})},testApiConnection:function(){var e=this,o=t("#test-api"),n=o.text();o.prop("disabled",!0).text(tmuTmdbSettings.strings.testing),t.ajax({url:tmuTmdbSettings.ajax_url,type:"POST",data:{action:"tmu_test_tmdb_api",nonce:tmuTmdbSettings.nonce},success:function(t){t.success?e.showNotice("success",t.data.message):e.showNotice("error",t.data)},error:function(){e.showNotice("error","Network error occurred")},complete:function(){o.prop("disabled",!1).text(n)}})},bulkSync:function(){var e=this,o=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"all";if(confirm(tmuTmdbSettings.strings.confirm_bulk_sync)){var n=t("all"===o?"#bulk-sync":"#sync-".concat(o)),s=n.text();n.prop("disabled",!0).text(tmuTmdbSettings.strings.syncing),this.showProgressModal(),this.updateProgress(0,"Initializing sync..."),t.ajax({url:tmuTmdbSettings.ajax_url,type:"POST",data:{action:"tmu_bulk_sync_tmdb",post_type:o,nonce:tmuTmdbSettings.nonce},success:function(t){t.success?(e.updateProgress(100,t.data.message),e.showNotice("success",t.data.message),setTimeout(function(){return e.closeModal()},3e3)):(e.updateProgress(100,"Sync failed: "+t.data),e.showNotice("error",t.data))},error:function(){e.updateProgress(100,"Network error occurred"),e.showNotice("error","Network error occurred")},complete:function(){n.prop("disabled",!1).text(s)}})}},clearCache:function(){var e=this;if(confirm(tmuTmdbSettings.strings.confirm_clear_cache)){var o=t("#clear-cache"),n=o.text();o.prop("disabled",!0).text("Clearing..."),t.ajax({url:tmuTmdbSettings.ajax_url,type:"POST",data:{action:"tmu_clear_tmdb_cache",nonce:tmuTmdbSettings.nonce},success:function(t){t.success?e.showNotice("success",t.data.message):e.showNotice("error",t.data)},error:function(){e.showNotice("error","Network error occurred")},complete:function(){o.prop("disabled",!1).text(n)}})}},testWebhook:function(){var e=this,o=t("#test-webhook"),n=o.text();o.prop("disabled",!0).text("Testing..."),t.ajax({url:tmuTmdbSettings.ajax_url,type:"POST",data:{action:"tmu_test_webhook",nonce:tmuTmdbSettings.nonce},success:function(t){t.success?e.showNotice("success",t.data.message):e.showNotice("error",t.data.message)},error:function(){e.showNotice("error","Network error occurred")},complete:function(){o.prop("disabled",!1).text(n)}})},syncSingle:function(e){var o=this;e.preventDefault();var n=t(e.currentTarget),s=n.data("post-id"),r=n.text();n.prop("disabled",!0).text("Syncing..."),t.ajax({url:tmuTmdbSettings.ajax_url,type:"POST",data:{action:"tmu_sync_single_tmdb",post_id:s,nonce:tmuTmdbSettings.nonce},success:function(t){t.success?(o.showNotice("success",t.data.message),setTimeout(function(){return location.reload()},1500)):o.showNotice("error",t.data)},error:function(){o.showNotice("error","Network error occurred")},complete:function(){n.prop("disabled",!1).text(r)}})},quickView:function(e){var o=this;e.preventDefault();var n=t(e.currentTarget).data("post-id");t.ajax({url:tmuTmdbSettings.ajax_url,type:"POST",data:{action:"tmu_quick_view",post_id:n,nonce:tmuTmdbSettings.nonce},success:function(t){t.success?o.showModal(t.data.html,"tmu-quick-view-modal"):o.showNotice("error","Failed to load content")},error:function(){o.showNotice("error","Network error occurred")}})},addToWatchlist:function(e){var o=this;e.preventDefault();var n=t(e.currentTarget),s=n.data("post-id");t.ajax({url:tmuTmdbSettings.ajax_url,type:"POST",data:{action:"tmu_add_watchlist",post_id:s,nonce:tmuTmdbSettings.nonce},success:function(t){t.success?(n.toggleClass("added"),o.showNotice("success",t.data.message)):o.showNotice("error",t.data)},error:function(){o.showNotice("error","Network error occurred")}})},showTrailer:function(e){e.preventDefault();var o=t(e.currentTarget).data("video-key"),n=t(e.currentTarget).data("video-site")||"YouTube",s="";if("YouTube"===n?s="https://www.youtube.com/embed/".concat(o,"?autoplay=1"):"Vimeo"===n&&(s="https://player.vimeo.com/video/".concat(o,"?autoplay=1")),s){var r='\n                    <div class="tmu-video-container">\n                        <iframe src="'.concat(s,'" \n                                frameborder="0" \n                                allowfullscreen \n                                allow="autoplay; encrypted-media">\n                        </iframe>\n                    </div>\n                ');this.showModal(r,"tmu-video-modal")}},initProgressModal:function(){0===t("#tmu-progress-modal").length&&t("body").append('\n                    <div id="tmu-progress-modal" class="tmu-modal" style="display: none;">\n                        <div class="tmu-modal-overlay"></div>\n                        <div class="tmu-modal-content">\n                            <div class="tmu-modal-header">\n                                <h3>Sync Progress</h3>\n                                <button class="tmu-modal-close">&times;</button>\n                            </div>\n                            <div class="tmu-modal-body">\n                                <div class="tmu-progress-bar">\n                                    <div class="tmu-progress-fill"></div>\n                                </div>\n                                <div class="tmu-progress-text">\n                                    <span id="tmu-progress-status">Initializing...</span>\n                                </div>\n                                <div class="tmu-sync-log"></div>\n                            </div>\n                        </div>\n                    </div>\n                ')},showProgressModal:function(){t("#tmu-progress-modal").fadeIn(300),t("body").addClass("tmu-modal-open")},updateProgress:function(e,o){t(".tmu-progress-fill").css("width",e+"%"),t("#tmu-progress-status").text(o),100===e&&t(".tmu-progress-bar").addClass("complete")},showModal:function(e){var o='\n                <div class="tmu-modal '.concat(arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",'">\n                    <div class="tmu-modal-overlay"></div>\n                    <div class="tmu-modal-content">\n                        <div class="tmu-modal-header">\n                            <button class="tmu-modal-close">&times;</button>\n                        </div>\n                        <div class="tmu-modal-body">\n                            ').concat(e,"\n                        </div>\n                    </div>\n                </div>\n            ");t(o).appendTo("body").fadeIn(300),t("body").addClass("tmu-modal-open")},closeModal:function(){t(".tmu-modal").fadeOut(300,function(){t(this).remove()}),t("body").removeClass("tmu-modal-open")},showNotice:function(e,o){var n=t('\n                <div class="notice '.concat("success"===e?"notice-success":"notice-error",' is-dismissible">\n                    <p>').concat(o,'</p>\n                    <button type="button" class="notice-dismiss">\n                        <span class="screen-reader-text">Dismiss this notice.</span>\n                    </button>\n                </div>\n            '));t(".wrap h1").after(n),setTimeout(function(){n.fadeOut(300,function(){t(this).remove()})},5e3),n.on("click",".notice-dismiss",function(){n.fadeOut(300,function(){t(this).remove()})})},ajaxRequest:function(n){var s=this,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,c=function(t){for(var n=1;n<arguments.length;n++){var s=null!=arguments[n]?arguments[n]:{};n%2?e(Object(s),!0).forEach(function(e){o(t,e,s[e])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(s)):e(Object(s)).forEach(function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(s,e))})}return t}({action:n,nonce:tmuTmdbSettings.nonce},r);return t.ajax({url:tmuTmdbSettings.ajax_url,type:"POST",data:c,success:function(t){i&&i(t)},error:function(t,e,o){console.error("AJAX Error:",o),s.showNotice("error","Network error occurred")}})}};t(document).ready(function(){n.init()}),window.TMDBSync=n}(jQuery)})();